
<h2>Attendance Report</h2>

<!-- Filter Form -->
<form method="get" action="">
    <label for="from_date">From Date:</label>
    <input type="date" id="from_date" name="from_date" value="{{ from_date }}">

    <label for="to_date">To Date:</label>
    <input type="date" id="to_date" name="to_date" value="{{ to_date }}">

    <label for="user">User:</label>
    <select name="user" id="user">
        <option value="">-- Select User --</option>
        {% for user in users %}
        <option value="{{ user.id }}" {% if selected_user == user.id|stringformat:"s" %}selected{% endif %}>
            {{ user.username }}
        </option>
        {% endfor %}
    </select>

    <button type="submit">Generate Report</button>
</form>

{% if report %}
    {% for user_data in report %}
    <h3>Attendance Report for {{ user_data.user.username }}</h3>
    <table border="1" style="margin-top: 20px; width: 100%; border-collapse: collapse;">
        <thead>
            <tr>
                <th>Date</th>
                <th>Status</th>
                <th>Check-in Time</th>
                <th>Check-out Time</th>
                <th>Total Hours Worked</th>
                <th>Late</th>
            </tr>
        </thead>
        <tbody>
            {% for record in user_data.attendance %}
            <tr>
                <td>{{ record.date }}</td>
                <td>{{ record.status }}</td>
                <td>{{ record.check_in_time|default:"-" }}</td>
                <td>{{ record.check_out_time|default:"-" }}</td>
                <td>{{ record.total_hours }}</td>
                <td>{% if record.late %}Yes{% else %}No{% endif %}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div style="margin-top: 20px;">
        <strong>Total Present Days:</strong> {{ user_data.present_count }} <br>
        <strong>Total Half-Day Days:</strong> {{ user_data.half_day_count }}
    </div> 

    {% endfor %}
{% else %}
    <p>Please select a user and date range to generate the report.</p>
{% endif %}

